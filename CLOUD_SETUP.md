# 云函数配置说明

## 概述
本项目使用微信小程序云开发功能实现反馈页面的点赞和评论功能。需要配置云环境和数据库。

## 配置步骤

### 1. 开通云开发
1. 在微信开发者工具中打开项目
2. 点击工具栏中的"云开发"按钮
3. 按照提示开通云开发服务
4. 创建云环境（建议创建两个环境：测试环境和生产环境）

### 2. 配置云环境ID
**重要：** 为了保护敏感信息，云环境ID现在通过配置文件管理，不会被提交到git。

1. 复制配置示例文件：
   ```bash
   cp miniprogram/config.example.js miniprogram/config.js
   ```

2. 编辑 `miniprogram/config.js`，填入你的云环境ID：
   ```javascript
   module.exports = {
     // 微信云开发环境ID
     cloudEnv: 'your-env-id-here', // 替换为你的实际云环境ID
   };
   ```

3. 云环境ID可以在微信开发者工具的云开发控制台中找到

**注意：** `miniprogram/config.js` 文件已被添加到 `.gitignore` 中，不会被提交到版本控制系统。

### 3. 部署云函数
1. 右键点击 `cloudfunctions/login` 文件夹
2. 选择"创建并部署：云端安装依赖（不上传 node_modules）"
3. 右键点击 `cloudfunctions/feedback` 文件夹
4. 选择"创建并部署：云端安装依赖（不上传 node_modules）"

### 4. 配置数据库
在云开发控制台中创建以下集合：

#### comments 集合（评论）
- 权限设置：所有用户可读，仅创建者可写
- 字段说明：
  - `_id`：系统自动生成
  - `content`：评论内容（字符串，必填）
  - `nickName`：用户昵称（字符串）
  - `avatarUrl`：用户头像URL（字符串）
  - `openid`：用户openid（字符串，必填）
  - `createTime`：创建时间（日期，必填）
  - `isDeleted`：是否删除（布尔值，默认false）

#### likes 集合（点赞）
- 权限设置：所有用户可读，仅创建者可写
- 字段说明：
  - `_id`：系统自动生成
  - `createTime`：创建时间（日期，必填）

### 5. 设置数据库索引（可选，用于优化性能）
1. 在 `comments` 集合中为 `createTime` 字段创建降序索引

### 6. 测试功能
1. 在小程序中进入反馈页面
2. 测试点赞功能
3. 测试评论发布功能
4. 测试评论列表加载功能

## 注意事项
1. 云函数部署后需要等待几分钟才能生效
2. 确保小程序已开通云开发权限
3. 生产环境请妥善保管云环境ID
4. 建议定期备份数据库数据
5. 可以在云开发控制台中查看函数调用日志和数据库操作记录

## 故障排除
1. 如果云函数调用失败，检查：
   - 云环境ID是否正确
   - 云函数是否部署成功
   - 网络连接是否正常

2. 如果数据库操作失败，检查：
   - 集合权限设置是否正确
   - 数据格式是否符合要求
   - 用户是否有操作权限

## 费用说明
- 云函数调用：按调用次数计费
- 数据库操作：按读写次数计费
- 存储空间：按使用容量计费
- 具体费用请参考微信云开发官方文档