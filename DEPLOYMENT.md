# 部署清单 v1.2.0

## 🚀 版本升级指南

从v1.1.0升级到v1.2.0的完整部署流程。

### 📋 升级前检查

- [ ] 确认当前小程序运行正常
- [ ] 备份云数据库中的数据（可选）
- [ ] 确保微信开发者工具版本为最新

### 🔄 云函数部署

#### 1. 部署feedback云函数
1. 在微信开发者工具中，右键点击 `cloudfunctions/feedback` 文件夹
2. 选择 **"上传并部署：云端安装依赖"**
3. 等待部署完成，确保没有错误提示

#### 2. 验证云函数部署
在云开发控制台 → 云函数页面：
- [ ] 确认 `feedback` 函数显示为"部署成功"
- [ ] 查看函数详情，确认最新更新时间

### 🗄️ 数据库配置

#### 1. 检查likes集合
在云开发控制台 → 数据库页面：
- [ ] 确认 `likes` 集合存在
- [ ] 检查集合权限：所有用户可读，仅创建者可写

#### 2. 优化数据库索引（推荐）
为 `likes` 集合的 `createTime` 字段创建降序索引：
1. 进入 `likes` 集合
2. 点击"索引管理"
3. 添加索引：字段 `createTime`，类型选择"降序"

### 📱 小程序功能测试

#### 1. 基础功能测试
- [ ] 打开反馈页面，确认界面正常显示
- [ ] 点击爱心图标，确认身份选择弹窗正常弹出
- [ ] 测试匿名点赞功能
- [ ] 测试自定义昵称点赞功能

#### 2. 数据显示测试
- [ ] 确认点赞数量正确显示
- [ ] 确认点赞记录正确显示（最近10条）
- [ ] 确认点赞后记录立即更新

#### 3. UI界面测试
- [ ] 确认身份选择弹窗按钮适配屏幕宽度
- [ ] 确认点赞记录采用紧凑横排显示
- [ ] 测试不同屏幕尺寸的适配效果

### 🧹 清理工作（可选）

#### 1. 清理旧数据（如果需要）
如果之前有comments集合的数据，可以选择：
- 保留：comments集合不会影响新功能
- 删除：在云开发控制台中删除comments集合

#### 2. 清理未使用的云函数（如果有）
检查是否有其他不需要的云函数可以删除。

### ⚠️ 注意事项

1. **向下兼容性**: v1.2.0去除了留言功能，如果用户习惯了留言功能，需要提前通知
2. **数据迁移**: 现有的点赞数据会保留，但格式可能略有不同
3. **权限检查**: 确保云函数和数据库权限设置正确
4. **缓存清理**: 建议清理小程序缓存，确保用户看到最新界面

### 🔧 故障排除

#### 常见问题
1. **点赞记录不显示**
   - 检查likes集合是否存在
   - 检查云函数feedback是否部署成功
   - 查看云开发控制台的错误日志

2. **身份选择弹窗显示异常**
   - 清理小程序缓存重新进入
   - 检查WXSS样式是否正确加载

3. **点赞功能失效**
   - 检查网络连接
   - 确认云函数权限设置
   - 查看小程序调试控制台的错误信息

### 📞 技术支持

如果在部署过程中遇到问题，可以：
1. 查看微信开发者工具的控制台错误信息
2. 检查云开发控制台的日志
3. 参考 CLOUD_SETUP.md 文档

### ✅ 部署完成确认

部署完成后，确认以下功能正常：
- [ ] 点赞数量统计正确
- [ ] 身份选择功能正常
- [ ] 点赞记录显示正常
- [ ] UI界面美观适配
- [ ] 无控制台错误信息

---

**版本**: v1.2.0  
**更新日期**: 2024年  
**兼容性**: 微信小程序基础库 2.2.3+ 